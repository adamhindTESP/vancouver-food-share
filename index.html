<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üçÖ Vancouver Food Share</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      max-width: 640px;
      margin: 0 auto;
      padding: 16px;
      background: #f8f9fa;
    }

    .card {
      background: #ffffff;
      border-radius: 14px;
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    h1, h2 {
      margin-bottom: 8px;
    }

    p.muted {
      color: #6b7280;
      font-size: 14px;
    }

    button, input, select {
      width: 100%;
      padding: 12px;
      margin-top: 8px;
      font-size: 16px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
    }

    button {
      background: #10b981;
      color: white;
      font-weight: 600;
      border: none;
      cursor: pointer;
    }

    button.secondary {
      background: #6b7280;
    }

    button:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }

    .mode-buttons {
      display: flex;
      gap: 12px;
    }

    .info {
      background: #dbeafe;
      border-left: 4px solid #3b82f6;
      padding: 12px;
      border-radius: 8px;
      margin-top: 12px;
    }

    .success {
      background: #dcfce7;
      border-left: 4px solid #16a34a;
      padding: 12px;
      border-radius: 8px;
      margin-top: 12px;
    }

    .food-item {
      background: #f0fdf4;
      border-left: 4px solid #10b981;
      padding: 14px;
      border-radius: 10px;
      margin-top: 10px;
    }

    .footer {
      text-align: center;
      font-size: 13px;
      color: #6b7280;
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body>

<!-- HEADER -->
<div class="card">
  <h1>üçÖ Vancouver Food Share</h1>
  <p class="muted">
    Safe public pickup only.  
    Drop food ‚Üí list it ‚Üí anyone can pick up.
  </p>
</div>

<!-- APPROVED LOCATIONS -->
<div class="card">
  <h2>üè† Approved Storage Locations</h2>
  <p class="muted">Food may only be listed at approved public locations.</p>

  <ul id="approvedLocations" class="muted"></ul>
  <p id="noLocations" class="muted">
    No approved locations yet.  
    Please check back soon or apply below.
  </p>

  <button id="toggleSponsor" class="secondary">
    ‚ûï Apply as Storage Partner
  </button>

  <div id="sponsorForm" class="hidden">
    <input id="sName" placeholder="Place name" />
    <input id="sArea" placeholder="Neighbourhood / address" />
    <select id="sFridge">
      <option value="">Has a fridge?</option>
      <option value="yes">Yes</option>
      <option value="no">No</option>
    </select>
    <button id="submitSponsor">Submit application</button>
    <p class="muted">Applications are reviewed before approval.</p>
  </div>
</div>

<!-- ROLE SELECT -->
<div class="card" id="roleSelect">
  <h2>What brings you here?</h2>
  <div class="mode-buttons">
    <button id="btnGive">ü•¨ I Have Food</button>
    <button id="btnGet">ü•ó I Need Food</button>
  </div>
</div>

<!-- GIVE MODE -->
<div class="card hidden" id="giveMode">
  <button class="secondary" id="backGive">‚Üê Back</button>
  <h2>Drop Food ‚Üí List It</h2>

  <div class="success">
    Step 1: Drop food at an approved public location  
    <br>Step 2: List it here
  </div>

  <input id="foodDesc" placeholder="e.g. apples, bread, vegetables" />
  <select id="pickupLocation"></select>

  <label>
    <input type="checkbox" id="confirmDrop" /> Food is already dropped off
  </label>

  <button id="listFood" disabled>List for pickup</button>
</div>

<!-- GET MODE -->
<div class="card hidden" id="getMode">
  <button class="secondary" id="backGet">‚Üê Back</button>
  <h2>Food Listings</h2>

  <p class="muted">How many people are you feeding? (max 4)</p>
  <select id="peopleCount">
    <option value="1">1 person</option>
    <option value="2">2 people</option>
    <option value="3">3 people</option>
    <option value="4">4 people</option>
  </select>

  <div class="info" id="limitInfo"></div>
  <div id="foodListings"></div>
</div>

<!-- FOOTER -->
<div class="card footer">
  üõ°Ô∏è Guardian active ¬∑ Fair-share limits ¬∑ No accounts ¬∑ No tracking
</div>

<script>
(() => {
  const MAX_PEOPLE = 4;
  const KG_PER_PERSON = 2.5;
  const EXPIRY_MS = 24 * 60 * 60 * 1000;
  const bannedWords = ["bitcoin", "glory", "weapon", "sex", "drugs"];

  let food = JSON.parse(localStorage.getItem("food") || "[]");
  let sponsors = JSON.parse(localStorage.getItem("sponsors") || "[]");

  const approvedList = document.getElementById("approvedLocations");
  const noLocMsg = document.getElementById("noLocations");
  const pickupSelect = document.getElementById("pickupLocation");

  function refreshSponsors() {
    approvedList.innerHTML = "";
    pickupSelect.innerHTML = "<option value=''>Choose location ‚Üí</option>";

    const approved = sponsors.filter(s => s.approved);
    noLocMsg.style.display = approved.length ? "none" : "block";

    approved.forEach((s, i) => {
      approvedList.innerHTML += `<li>üè† ${s.name} (${s.area})</li>`;
      pickupSelect.innerHTML += `<option value="${i}">${s.name}</option>`;
    });
  }

  function cleanFood() {
    const now = Date.now();
    food = food.filter(f => now - f.time < EXPIRY_MS);
    localStorage.setItem("food", JSON.stringify(food));
  }

  function isValidFood(text) {
    return !bannedWords.some(w => text.toLowerCase().includes(w));
  }

  function show(id) {
    ["roleSelect","giveMode","getMode"].forEach(x =>
      document.getElementById(x).classList.add("hidden")
    );
    document.getElementById(id).classList.remove("hidden");
  }

  document.getElementById("btnGive").onclick = () => show("giveMode");
  document.getElementById("btnGet").onclick = () => { cleanFood(); show("getMode"); updateGet(); };
  document.getElementById("backGive").onclick = () => show("roleSelect");
  document.getElementById("backGet").onclick = () => show("roleSelect");

  document.getElementById("confirmDrop").onchange = e =>
    document.getElementById("listFood").disabled = !e.target.checked;

  document.getElementById("listFood").onclick = () => {
    const text = document.getElementById("foodDesc").value.trim();
    const locIdx = pickupSelect.value;
    if (!text || locIdx === "") return alert("Fill all fields.");
    if (!isValidFood(text)) return alert("Only food listings allowed.");

    food.unshift({
      item: text,
      location: sponsors[locIdx].name,
      time: Date.now()
    });

    localStorage.setItem("food", JSON.stringify(food));
    show("getMode");
    updateGet();
  };

  function updateGet() {
    const people = Math.min(+document.getElementById("peopleCount").value, MAX_PEOPLE);
    const limit = (people * KG_PER_PERSON).toFixed(1);
    document.getElementById("limitInfo").innerHTML =
      `To keep things fair, you may take up to <strong>${limit}kg</strong> today.`;

    const list = document.getElementById("foodListings");
    list.innerHTML = food.length
      ? food.map(f => `
        <div class="food-item">
          <strong>${f.item}</strong><br>
          üìç ${f.location}<br>
          ‚è≥ Expires in 24h
        </div>
      `).join("")
      : "<p class='muted'>No food available right now.</p>";
  }

  document.getElementById("toggleSponsor").onclick = () =>
    document.getElementById("sponsorForm").classList.toggle("hidden");

  document.getElementById("submitSponsor").onclick = () => {
    const name = sName.value.trim();
    const area = sArea.value.trim();
    if (!name || !area) return alert("Please fill in all fields.");

    sponsors.push({ name, area, approved:false });
    localStorage.setItem("sponsors", JSON.stringify(sponsors));
    alert("Thanks! We‚Äôll review this location.");
    sName.value = sArea.value = "";
  };

  cleanFood();
  refreshSponsors();
})();
</script>

</body>
</html>
